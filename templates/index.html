<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriYield Predictor | Advanced Yield Forecasting</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
</head>
<body class="d-flex flex-column min-vh-100">

    <video playsinline autoplay muted loop id="bg-video">
        <source src="{{ url_for('static', filename='videos/Video_01.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <header role="banner">
        <nav class="navbar navbar-expand-lg" id="main-nav">
            <div class="container-fluid container-xl">
                <a class="navbar-brand" href="/">
                    <i class="bi bi-bar-chart-line-fill"></i>
                    <span>AgriYield Predictor</span>
                </a>
                
                <div class="d-flex align-items-center">
                    <button class="btn btn-link nav-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#history-panel" aria-controls="history-panel" id="history-btn" aria-label="View prediction history">
                        <i class="bi bi-clock-history"></i>
                    </button>

                    <div class="form-check form-switch ms-auto" id="theme-switcher">
                        <input class="form-check-input" type="checkbox" role="switch" id="theme-toggle" aria-label="Toggle dark mode">
                        <label class="form-check-label" for="theme-toggle">
                            <i class="bi bi-moon-stars-fill" aria-hidden="true"></i>
                            <i class="bi bi-sun-fill" aria-hidden="true"></i>
                        </label>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main role="main" class="container-fluid container-xl my-auto py-5">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-8">
                
                <div class="wizard-container shadow-lg">
                    <header class="wizard-header">
                        <h1 class="wizard-title">New Yield Prediction</h1>
                        
                        <nav class="wizard-progress" aria-label="Prediction steps">
                            <ol class="wizard-progress-list" role="tablist">
                                <li class="wizard-progress-step" role="tab" aria-selected="true" aria-controls="step-panel-1" id="step-tab-1">
                                    <span class="step-indicator" aria-hidden="true">1</span>
                                    <span class="step-label">Context</span>
                                </li>
                                <li class="wizard-progress-step" role="tab" aria-selected="false" aria-controls="step-panel-2" id="step-tab-2">
                                    <span class="step-indicator" aria-hidden="true">2</span>
                                    <span class="step-label">Environment</span>
                                </li>
                                <li class="wizard-progress-step" role="tab" aria-selected="false" aria-controls="step-panel-3" id="step-tab-3">
                                    <span class="step-indicator" aria-hidden="true">3</span>
                                    <span class="step-label">Soil Data</span>
                                </li>
                            </ol>
                        </nav>
                    </header>

                    <form class="wizard-form" id="prediction-form" role="form" aria-label="Crop yield prediction form" novalidate>
                        
                        <section id="step-panel-1" role="tabpanel" aria-labelledby="step-tab-1" class="wizard-step-panel" data-step="1">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <label for="crop" class="form-label">Crop Type</label>
                                    <select id="crop" name="crop" class="form-select" required aria-describedby="crop-error">
                                        <option value="" disabled selected>Select Crop</option>
                                        {% for crop in crops %}
                                            <option value="{{ crop }}">{{ crop }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="invalid-feedback" id="crop-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="state" class="form-label">State</label>
                                    <select id="state" name="state" class="form-select" required aria-describedby="state-error">
                                        <option value="" disabled selected>Select State</option>
                                        {% for state in states %}
                                            <option value="{{ state }}">{{ state }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="invalid-feedback" id="state-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="season" class="form-label">Season</label>
                                    <select id="season" name="season" class="form-select" required aria-describedby="season-error">
                                        <option value="" disabled selected>Select Season</option>
                                        {% for season in seasons %}
                                            <option value="{{ season }}">{{ season }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="invalid-feedback" id="season-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="crop_year" class="form-label">Crop Year</label>
                                    <input type="number" id="crop_year" name="crop_year" class="form-control" placeholder="e.g., 2024" min="1990" max="2050" required aria-describedby="year-error">
                                    <div class="invalid-feedback" id="year-error" aria-live="polite"></div>
                                </div>
                            </div>
                        </section>

                        <section id="step-panel-2" role="tabpanel" aria-labelledby="step-tab-2" class="wizard-step-panel" data-step="2" hidden>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label for="annual_rainfall" class="form-label">Annual Rainfall (mm)</label>
                                    <input type="number" id="annual_rainfall" name="annual_rainfall" class="form-control" placeholder="e.g., 1500.5" step="0.01" min="0" required aria-describedby="rainfall-error">
                                    <div class="invalid-feedback" id="rainfall-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="fertilizer" class="form-label">Fertilizer (kg/ha)</label>
                                    <input type="number" id="fertilizer" name="fertilizer" class="form-control" placeholder="e.g., 75000" step="0.01" min="0" required aria-describedby="fertilizer-error">
                                    <div class="invalid-feedback" id="fertilizer-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="pesticide" class="form-label">Pesticide (kg/ha)</label>
                                    <input type="number" id="pesticide" name="pesticide" class="form-control" placeholder="e.g., 3000" step="0.01" min="0" required aria-describedby="pesticide-error">
                                    <div class="invalid-feedback" id="pesticide-error" aria-live="polite"></div>
                                </div>
                            </div>
                        </section>

                        <section id="step-panel-3" role="tabpanel" aria-labelledby="step-tab-3" class="wizard-step-panel" data-step="3" hidden>
                            <div class="row g-3">
                                <div class="col-12 col-md-4">
                                    <label for="n_soil" class="form-label">N (mg/kg)</label>
                                    <input type="number" id="n_soil" name="n_soil" class="form-control" placeholder="e.g., 160.5" step="0.01" min="0" required aria-describedby="n-error">
                                    <div class="invalid-feedback" id="n-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <label for="p_soil" class="form-label">P (mg/kg)</label>
                                    <input type="number" id="p_soil" name="p_soil" class="form-control" placeholder="e.g., 18.2" step="0.01" min="0" required aria-describedby="p-error">
                                    <div class="invalid-feedback" id="p-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <label for="k_soil" class="form-label">K (mg/kg)</label>
                                    <input type="number" id="k_soil" name="k_soil" class="form-control" placeholder="e.g., 200.0" step="0.01" min="0" required aria-describedby="k-error">
                                    <div class="invalid-feedback" id="k-error" aria-live="polite"></div>
                                </div>
                                <div class="col-12">
                                     <label for="ph_soil" class="form-label">Soil pH</label>
                                     <input type="number" id="ph_soil" name="ph_soil" class="form-control" placeholder="e.g., 7.2" step="0.01" min="0" max="14" required aria-describedby="ph-error">
                                     <div class="invalid-feedback" id="ph-error" aria-live="polite"></div>
                                </div>
                            </div>
                        </section>

                        <footer class="wizard-controls">
                            <div class="wizard-nav">
                                <button type="button" class="btn btn-secondary" id="prev-btn" style="visibility: hidden;">
                                    <i class="bi bi-arrow-left"></i> Previous
                                </button>
                                <button type="button" class="btn btn-primary" id="next-btn">
                                    Next <i class="bi bi-arrow-right"></i>
                                </button>
                                <button type="submit" class="btn btn-success" id="submit-btn" style="display: none;">
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                    <i class="bi bi-bar-chart-fill"></i>
                                    Predict Yield
                                </button>
                            </div>
                        </footer>
                    </form>
                </div>
                
                <section class="result-container" id="result-container" style="display: none;" aria-live="polite">
                    <figure class="result-card" id="result-card">
                        <figcaption class="result-header">
                            <h2 class="result-title">Prediction Failed</h2>
                            <p class="result-subtitle" id="result-subtitle">An error occurred.</p>
                        </figcaption>
                        <div class="result-body">
                            <div class="result-icon-container">
                                <i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i>
                            </div>
                            <div class="result-value-container">
                                <strong class="result-value" id="result-value">--</strong>
                                <span class="result-unit" id="result-unit">---</span>
                            </div>
                        </div>
                        <figcaption class="result-footer">
                            <button type="button" class="btn btn-reset" id="new-prediction-btn">
                                <i class="bi bi-arrow-clockwise"></i> New Prediction
                            </button>
                        </figcaption>
                    </figure>
                </section>
                
            </div>
        </div>
    </main>

    <footer class="main-footer mt-5" role="contentinfo">
        <p>&copy; 2025 AgriYield Predictor. All rights reserved.</p>
    </footer>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="history-panel" aria-labelledby="history-panel-label">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="history-panel-label"><i class="bi bi-clock-history"></i> Prediction History</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body" id="history-panel-body">
            <p id="history-empty-state" class="text-center text-muted">No predictions have been made in this session.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>